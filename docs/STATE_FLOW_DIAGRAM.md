# Clinical Insights ç‹€æ…‹æµç¨‹åœ–

## ğŸ“Š é‡æ§‹å‰çš„ç‹€æ…‹æµç¨‹ï¼ˆæœ‰å•é¡Œï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Feature.tsx                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  useInsightPanels    â”‚    â”‚ useInsightGeneration â”‚     â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚     â”‚
â”‚  â”‚  âŒ responses (A)    â”‚    â”‚  âŒ responses (B)    â”‚     â”‚
â”‚  â”‚  âŒ panelStatus (A)  â”‚    â”‚  âŒ panelStatus (B)  â”‚     â”‚
â”‚  â”‚  âœ… prompts          â”‚    â”‚  âœ… prompts          â”‚     â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚     â”‚
â”‚  â”‚  setResponses(A)     â”‚    â”‚  setResponses(B)     â”‚     â”‚
â”‚  â”‚  setPanelStatus(A)   â”‚    â”‚  setPanelStatus(B)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                            â”‚                    â”‚
â”‚           â”‚                            â”‚                    â”‚
â”‚           â–¼                            â–¼                    â”‚
â”‚  handleResponseChange        å¯¦éš›é¡¯ç¤ºçš„ responses          â”‚
â”‚  (åªæ›´æ–° A)                  (ä¾†è‡ª B)                      â”‚
â”‚                                                             â”‚
â”‚  âŒ å•é¡Œï¼šA å’Œ B ä¸åŒæ­¥ï¼                                   â”‚
â”‚  âŒ ç·¨è¼¯æ›´æ–°äº† Aï¼Œä½†é¡¯ç¤ºçš„æ˜¯ B                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‹€æ…‹é‡è¤‡ï¼š
- responses å­˜åœ¨æ–¼å…©å€‹åœ°æ–¹ (A å’Œ B)
- panelStatus å­˜åœ¨æ–¼å…©å€‹åœ°æ–¹ (A å’Œ B)
- æ²’æœ‰æ˜ç¢ºçš„ Single Source of Truth
```

## âœ… é‡æ§‹å¾Œçš„ç‹€æ…‹æµç¨‹ï¼ˆSSOTï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Feature.tsx                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  useInsightPanels    â”‚    â”‚ useInsightGeneration â”‚     â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚     â”‚
â”‚  â”‚  âœ… prompts only     â”‚    â”‚  âœ… responses (SSOT) â”‚     â”‚
â”‚  â”‚  (no state)          â”‚    â”‚  âœ… panelStatus      â”‚     â”‚
â”‚  â”‚                      â”‚    â”‚  âœ… setResponses     â”‚     â”‚
â”‚  â”‚  handlePromptChange  â”‚    â”‚  âœ… setPanelStatus   â”‚     â”‚
â”‚  â”‚  (delegates)         â”‚    â”‚                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                        â”‚                    â”‚
â”‚                                        â”‚ (å”¯ä¸€ç‹€æ…‹æº)       â”‚
â”‚                                        â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Feature.tsx å‰µå»ºçš„ handlers                â”‚          â”‚
â”‚  â”‚                                             â”‚          â”‚
â”‚  â”‚  handleResponseChange(id, value)            â”‚          â”‚
â”‚  â”‚    â””â”€> setResponses(prev => ...)           â”‚          â”‚
â”‚  â”‚                                             â”‚          â”‚
â”‚  â”‚  clearResponse(id)                          â”‚          â”‚
â”‚  â”‚    â””â”€> setResponses(prev => ...)           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚           InsightPanel çµ„ä»¶                                â”‚
â”‚           (é¡¯ç¤º responses)                                 â”‚
â”‚                                                             â”‚
â”‚  âœ… å–®ä¸€ç‹€æ…‹æºï¼šåªæœ‰ useInsightGeneration æ“æœ‰ responses   â”‚
â”‚  âœ… æ‰€æœ‰æ›´æ–°éƒ½é€šé setResponses                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ è©³ç´°çš„æ•¸æ“šæµå‘

### é‡æ§‹å‰ï¼ˆæœ‰å•é¡Œï¼‰

```
ç”¨æˆ¶ç·¨è¼¯ response
    â†“
InsightPanel.onResponseChange
    â†“
Feature.handleResponseChange (ä¾†è‡ª useInsightPanels)
    â†“
useInsightPanels.setResponses(A) â† æ›´æ–°é€™è£¡
    â†“
âŒ ä½† Feature.tsx é¡¯ç¤ºçš„æ˜¯ useInsightGeneration.responses(B)
    â†“
âŒ ç”¨æˆ¶çœ‹ä¸åˆ°æ›´æ–°ï¼
```

### é‡æ§‹å¾Œï¼ˆæ­£ç¢ºï¼‰

```
ç”¨æˆ¶ç·¨è¼¯ response
    â†“
InsightPanel.onResponseChange
    â†“
Feature.handleResponseChange (ä½¿ç”¨ setResponses from useInsightGeneration)
    â†“
useInsightGeneration.setResponses â† å”¯ä¸€çš„ç‹€æ…‹æ›´æ–°é»
    â†“
useInsightGeneration.responses æ›´æ–°
    â†“
Feature.tsx é¡¯ç¤ºæ›´æ–°å¾Œçš„ responses
    â†“
âœ… ç”¨æˆ¶ç«‹å³çœ‹åˆ°æ›´æ–°ï¼
```

## ğŸ“‹ ç‹€æ…‹æ‰€æœ‰æ¬Šè¡¨

| ç‹€æ…‹é¡å‹ | é‡æ§‹å‰ | é‡æ§‹å¾Œ | æ”¹é€² |
|---------|--------|--------|------|
| **responses** | useInsightPanels âŒ<br>useInsightGeneration âŒ | useInsightGeneration âœ… | å–®ä¸€æ‰€æœ‰è€… |
| **panelStatus** | useInsightPanels âŒ<br>useInsightGeneration âŒ | useInsightGeneration âœ… | å–®ä¸€æ‰€æœ‰è€… |
| **prompts** | useInsightPanels âœ… | useInsightPanels âœ… | ä¿æŒä¸è®Š |

## ğŸ¯ é—œéµæ”¹é€²é»

### 1. æ˜ç¢ºçš„è·è²¬åˆ†é›¢

**useInsightPanels (38 lines)**
- âœ… è·è²¬ï¼šç®¡ç† prompts è§£æ
- âœ… ä¸æ“æœ‰ä»»ä½•ç‹€æ…‹
- âœ… åªæ˜¯ä¸€å€‹å·¥å…·å‡½æ•¸

**useInsightGeneration**
- âœ… è·è²¬ï¼šç®¡ç† AI ç”Ÿæˆé‚è¼¯
- âœ… æ“æœ‰ responses å’Œ panelStatus
- âœ… æä¾› setResponses çµ¦å¤–éƒ¨ä½¿ç”¨

**Feature.tsx**
- âœ… è·è²¬ï¼šå”èª¿å’Œçµ„åˆ
- âœ… ä½¿ç”¨ SSOT çš„ setResponses å‰µå»º handlers
- âœ… ä¸æ“æœ‰ç‹€æ…‹ï¼Œåªæ˜¯æ¶ˆè²»è€…

### 2. æ•¸æ“šæµå‘æ¸…æ™°

```
State Owner (useInsightGeneration)
    â†“ provides setResponses
Feature.tsx (creates handlers)
    â†“ passes handlers
InsightPanel (triggers events)
    â†“ calls handlers
Back to State Owner (updates state)
    â†“ re-renders
Feature.tsx (displays updated state)
```

### 3. é˜²æ­¢æœªä¾†å•é¡Œ

âœ… **Single Source of Truth** - æ¯å€‹ç‹€æ…‹åªæœ‰ä¸€å€‹æ‰€æœ‰è€…
âœ… **Clear Ownership** - æ–‡æª”ä¸­æ˜ç¢ºæ¨™è¨»èª°æ“æœ‰ä»€éº¼
âœ… **Unidirectional Data Flow** - æ•¸æ“šåªå‘ä¸€å€‹æ–¹å‘æµå‹•
âœ… **No State Duplication** - ä¸æœƒæœ‰é‡è¤‡çš„ç‹€æ…‹

## ğŸ“š å­¸åˆ°çš„æ•™è¨“

### âŒ éŒ¯èª¤æ¨¡å¼
```typescript
// ä¸è¦é€™æ¨£åšï¼šå¤šå€‹ hooks ç®¡ç†ç›¸åŒçš„ç‹€æ…‹
const { responses: responsesA } = useHookA()
const { responses: responsesB } = useHookB()
// å“ªå€‹æ˜¯çœŸå¯¦çš„ï¼Ÿ
```

### âœ… æ­£ç¢ºæ¨¡å¼
```typescript
// æ‡‰è©²é€™æ¨£åšï¼šæ˜ç¢ºçš„ç‹€æ…‹æ‰€æœ‰è€…
const { responses, setResponses } = useStateOwner() // SSOT
const { prompts } = useStatelessHelper() // ç„¡ç‹€æ…‹å·¥å…·
```

## ğŸ” å¦‚ä½•æª¢æŸ¥ SSOT åˆè¦æ€§

åœ¨é‡æ§‹æ™‚å•è‡ªå·±ï¼š

1. âœ… é€™å€‹ç‹€æ…‹æœ‰å”¯ä¸€çš„æ‰€æœ‰è€…å—ï¼Ÿ
2. âœ… æ‰€æœ‰æ›´æ–°éƒ½é€šéåŒä¸€å€‹ setter å—ï¼Ÿ
3. âœ… æ²’æœ‰é‡è¤‡çš„ç‹€æ…‹å‰¯æœ¬å—ï¼Ÿ
4. âœ… æ•¸æ“šæµå‘æ˜¯å–®å‘çš„å—ï¼Ÿ
5. âœ… è·è²¬åˆ†é›¢æ˜¯å¦æ¸…æ™°ï¼Ÿ

å¦‚æœä»»ä½•ä¸€å€‹ç­”æ¡ˆæ˜¯ "å¦"ï¼Œå°±éœ€è¦é‡æ§‹ï¼
